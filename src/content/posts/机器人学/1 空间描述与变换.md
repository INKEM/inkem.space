---
title: 【机器人学|运动学与动力学】#1 空间描述与变换
published: 2025-01-25
description: 表达零件、工具以及机构本身的位置和姿态的数学量。
tags: [旋转矩阵, 齐次变换矩阵, 固定角, 欧拉角, 等效角度-轴线表示法]
category: 运动学与动力学
---
# 齐次变换矩阵

机器人操作的定义是指通过某种机构使零件和工具在空间中运动，为此我们需要表达零件、工具以及机构本身的位置和姿态，其包括三个基本问题：

- 如何描述一个物体在空间中的位姿；
- 如何在不同的参照物下描述一个物体的位姿；
- 如何描述一个物体在空间中的运动。

这三个问题分别对应着位姿描述、变换映射和变换算子，它们可以统一由齐次变换矩阵表示。

我们采用**世界坐标系**（World Frame）作为讨论任何问题的基本参照。一个坐标系$\{A\}$用三个相互正交的单位矢量$\hat X_A,\hat Y_A,\hat Z_A$来表示。

![Pasted image 20251201211127|188](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251201211127.png)

## 位姿描述

**位置**（Position）表示物体在空间中的坐标。世界坐标系中任何点的位置都可以由一个$3\times1$的**位置矢量**来描述。我们用$^AP$表示点$P$在$\{A\}$下的位置矢量

$$
^AP=\begin{bmatrix}p_x\\p_y\\p_z\end{bmatrix}
$$

![Pasted image 20251201211831|241](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251201211831.png)

**姿态**（Orientation）表示物体的旋转状态或朝向。为了描述物体的姿态，我们需要在物体上固定一个坐标系，并且给出此坐标系相对于参考坐标系的描述。假设固定在物体上的坐标系为$\{B\}$，其主轴方向的单位矢量为$\hat X_B,\hat Y_B,\hat Z_B$，则以$\{A\}$为参考坐标系描述$\{B\}$最基本的方法为给出$\{B\}$的主轴单位矢量在坐标系$\{A\}$下的表示$^A\hat X_B,^A\hat Y_B,^A\hat Z_B$。将$^A\hat X_B,^A\hat Y_B,^A\hat Z_B$按顺序排列可以得到一个$3\times3$的矩阵，我们称之为**旋转矩阵**（Rotation Matrix）。$\{B\}$相对于$\{A\}$的旋转矩阵用$^A_BR$表示

$$
^A_BR=(^A\hat X_B\quad^A\hat Y_B\quad^A\hat Z_B)=\begin{bmatrix}r_{11}&r_{12}&r_{13}\\r_{21}&r_{22}&r_{23}\\r_{31}&r_{32}&r_{33}\end{bmatrix}
$$

![Pasted image 20251201214211|400](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251201214211.png)

一个矢量的坐标是其在对应坐标系主轴单位矢量上的投影分量，因此$^A_BR$中的每个元素也可用$\{B\}$和$\{A\}$主轴单位矢量的点积表示

$$
^A_BR=(^A\hat X_B\quad^A\hat Y_B\quad^A\hat Z_B)=\begin{bmatrix}\hat X_B\cdot\hat X_A&\hat Y_B\cdot\hat X_A&\hat Z_B\cdot\hat X_A\\\hat X_B\cdot\hat Y_A&\hat Y_B\cdot\hat Y_A&\hat Z_B\cdot\hat Y_A\\\hat X_B\cdot\hat Z_A&\hat Y_B\cdot\hat Z_A&\hat Z_B\cdot\hat Z_A\end{bmatrix}
$$

进一步观察上式，可以发现$^A_BR$的行是$\{A\}$的主轴单位矢量在$\{B\}$中的表达，因此$^A_BR$和$^B_AR$之间互为转置

$$
^A_BR=(^A\hat X_B\quad^A\hat Y_B\quad^A\hat Z_B)=\begin{bmatrix}^B\hat X_A^T\\^B\hat Y_A^T\\^B\hat Z_A^T\end{bmatrix}={^B_AR}^T
$$

位置和姿态的组合称作**位姿**（Pose）。我们在物体上任选一点来描述其位置，并将其作为物体坐标系的原点。$\{B\}$相对于$\{A\}$的位姿由旋转矩阵$^A_BR$及其原点在$\{A\}$下的位置矢量$^AP_{BORG}$组成（下标ORG表示原点（Origin））

$$
\{B\}=\{^A_BR,{^AP_{BORG}}\}
$$

## 变换映射

将矢量描述从一个坐标系的描述转换到另一个坐标系的描述被称为**映射**（Mapping）。

当$\{A\}$与$\{B\}$的姿态相同，原点位置不同时，可以根据矢量加法由$^BP$得到$^AP$

$$
^AP={^BP}+{^AP_{BORG}}
$$

![Pasted image 20251202163706|450](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251202163706.png)

当$\{A\}$与$\{B\}$的原点位置相同，姿态不同时，$^AP$的每个分量即$^BP$在$\{A\}$的每个主轴单位矢量上的投影

$$
\begin{split}
^Ap_x={^B\hat X_A}\cdot{^BP}\\
^Ap_y={^B\hat Y_A}\cdot{^BP}\\
^Ap_z={^B\hat Z_A}\cdot{^BP}\\
\end{split}
$$

![Pasted image 20251212193931|219](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251212193931.png)

由于旋转矩阵$^A_BR$的每一行正是$^B\hat X_A,{^B\hat Y_A},{^B\hat Z_A}$，因此上式可写成矩阵相乘的简化形式

$$
^AP={^A_BR}{^BP}
$$

当$\{A\}$与$\{B\}$的原点位置和姿态都不相同时，我们可以引入一个中间坐标系$\{B'\}$。$\{B'\}$由$\{B\}$绕自身原点旋转到与$\{A\}$相同的姿态得到。

![Pasted image 20251202163744|500](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251202163744.png)

现在我们可以先将$^BP$通过旋转变换表示为$^{B'}P$，再通过平移变换表示为$^AP$

$$
\begin{split}
^{B'}P&={^A_BR}{^BP}\\
^AP&={^{B'}P}+{^AP_{BORG}}\\
&={^A_BR}{^BP}+{^AP_{BORG}}
\end{split}
$$

上式能够表示将一个矢量描述从一个坐标系变换到另一个坐标系的一般变换映射，我们同样可以利用矩阵对其进行简化

$$
\begin{bmatrix}^AP\\1\end{bmatrix}=\underset{^A_BT}{\underbrace{\begin{bmatrix}^A_BR&^AP_{BORG}\\\mathbf{0}^T&1\end{bmatrix}}}\begin{bmatrix}^BP\\1\end{bmatrix}
$$

其中$\mathbf 0^T$是一个三维零向量。$^A_BT$是$\{B\}$相对于$\{A\}$的**齐次变换矩阵**（Homogeneous Transformation Matrix），它完整地定义了由$\{B\}$到$\{A\}$的一般变换映射。在计算过程中我们可以省略第四行的元素，将其简写为以下形式

$$
^AP={^A_BT}{^AP}
$$

## 变换算子

用于对点或矢量进行移动或旋转的矩阵称为**算子**（Operator）。

**平移算子**将空间中的一个点沿着一个已知的矢量方向移动一定距离。假如位置矢量为$^AP_2$的点由位置矢量为$^AP_1$的点通过矢量$^AQ$进行平移得到，则$^AP_2$计算如下

$$
^AP_2={^AP_1}+{^AQ}
$$

![Pasted image 20251212193021|500](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251212193021.png)

用矩阵算子写出上述平移变换，有

$$
^AP_2=D_Q(q){^AP_1}
$$

其中$q$是沿单位矢量$\hat Q$方向平移的数量，即$^AQ=q\hat Q$。而算子$D_Q(q)$则将该平移表示为齐次变换形式

$$
D_Q(q)=\begin{bmatrix}1&0&0&q_x\\0&1&0&q_y\\0&0&1&q_z\\0&0&0&1\end{bmatrix}
$$

**旋转算子**将一个矢量以坐标系原点为中心旋转。旋转算子可以由旋转矩阵表示，假如$^AP_2$由$^AP_1$经旋转$R$得到，若我们同步将坐标系$\{A\}$旋转到$\{A'\}$，则此时

$$
^{A'}P_2={^AP_1}
$$

而我们现在只需根据变换映射，通过旋转矩阵$^{A'}_AR$将$^{A'}P_2$变换到$^AP_2$即可

$$
^AP_2={^{A'}_AR}{^{A'}P_2}={^{A'}_AR}{^AP_1}
$$

![Pasted image 20251212200454|275](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251212200454.png)

${^{A'}_AR}$即由$^AP_1$到$^AP_2$的旋转算子$R$，其齐次变换形式为

$$
R=\begin{bmatrix}r_{11}&r_{12}&r_{13}&0\\r_{21}&r_{22}&r_{23}&0\\r_{31}&r_{32}&r_{33}&0\\0&0&0&1\end{bmatrix}
$$

与$D_Q(q)$类似，为了在算子符号中表征具体的旋转操作，我们将用另一个符号$R_K(\theta)$定义旋转算子

$$
^AP_2=R_K(\theta){^AP_1}
$$

$R_K(\theta)$表示绕$\hat K$轴旋转$\theta$角度。对于一般的旋转轴$\hat K$，$R_K(\theta)$的形式较为复杂。而在三维空间中的任意旋转都可以被拆解为绕$\hat X,\hat Y,\hat Z$三个轴的旋转，以$\hat X,\hat Y,\hat Z$为轴的旋转算子则有如下简洁的形式（由于我们将在计算中用到许多三角函数，因此三角函数用对应首字母简记，即$\sin$记为$s$，$\cos$记为$c$）

$$
R_x(\theta)=\begin{bmatrix}1&0&0&0\\0&c\theta&-s\theta&0\\0&s\theta&c\theta&0\\0&0&0&1\end{bmatrix}
$$

$$
R_y(\theta)=\begin{bmatrix}c\theta&0&s\theta&0\\0&1&0&0\\-s\theta&0&c\theta&0\\0&0&0&1\end{bmatrix}
$$

$$
R_z(\theta)=\begin{bmatrix}c\theta&-s\theta&0&0\\s\theta&c\theta&0&0\\0&0&1&0\\0&0&0&1\end{bmatrix}
$$

（推导方法：直接列写坐标系绕自身$\hat X,\hat Y,\hat Z$旋转后得到的新主轴单位矢量在原坐标系下的坐标，进而得到对应的旋转矩阵）

关于具体的$R_K(\theta)$形式与绕坐标轴旋转的组合将在下一篇介绍。

与变换映射一样，同时包含平移和旋转变换的算子即一般变换算子，其形式与齐次变换矩阵相同

$$
T=\begin{bmatrix}r_{11}&r_{12}&r_{13}&q_x\\r_{21}&r_{22}&r_{23}&q_y\\r_{31}&r_{32}&r_{33}&q_z\\0&0&0&1\end{bmatrix}
$$

算子$T$将矢量$^AP_1$平移并旋转得到一个新矢量

$$
^AP_2=T{^AP_1}
$$

![Pasted image 20251212204005|500](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020251212204005.png)

至此，我们可以给出齐次变换矩阵的三种解释：

- **位姿描述**：$^A_BT$表示相对于坐标系$\{A\}$的坐标系$\{B\}$；
- **变换映射**：$^A_BT$是映射$^BP\rightarrow{^AP}$；
- **变换算子**：$T$将$^AP_1$变换为$^AP_2$。

## 复合变换与逆变换

多个变换的复合可以通过乘法计算。例如已知$\{C\}$相对于$\{B\}$的表示$^B_CT$和$\{B\}$相对于$\{A\}$的表示$^A_BT$，如果需要通过$^CP$求$^AP$，可先将$^CP$变换成$^BP$再变换成$^AP$：

$$
\begin{split}
^BP&={^B_CT}{^CP}\\
^AP&={^A_BT}{^BP}={^A_BT}{^B_CT}{^CP}
\end{split}
$$

由此可定义$^A_CT={^A_BT}{^B_CT}$。

我们还会需要通过$\{B\}$相对于$\{A\}$的表示$^A_BT$反求$\{A\}$相对于$\{B\}$的表示$^B_AT$，即求$^A_BT$的逆。求解思路是将其拆分为旋转变换和平移变换，即由$^A_BR$和$^AP_{BORG}$求$^B_AR$和$^BP_{AORG}$。

$^B_AR$的计算由旋转矩阵的性质可知

$$
^B_AR={^A_BR^T}
$$

$^BP_{AORG}$则可以由$^AP_{BORG}$到$^BP_{BORG}$映射方程间接得到

$$
\begin{split}
^BP_{BORG}&={^B_AT}{^AP_{BORG}}\\
&={^B_AR}{^AP_{BORG}}+{^BP_{AORG}}\\
\end{split}
$$

其中$^BP_{BORG}$即$\{B\}$的原点相对于$\{B\}$的坐标，值为零，因而

$$
\begin{split}
^BP_{AORG}&=-{^B_AR}{^AP_{BORG}}\\
&=-{^A_BR^T}{^AP_{BORG}}
\end{split}
$$

最终我们可以写出$^B_AT$为

$$
^B_AT=\begin{bmatrix}^A_BR^T&-{^A_BR^T}{^AP_{BORG}}\\\mathbf{0}^T&1\end{bmatrix}
$$

# 更多姿态描述

旋转矩阵使用9个分量来描述物体的姿态，但是这9个分量并不是相互独立的。对于一个旋转矩阵$R$，我们可以写出6个约束方程。如果我们用参考坐标系中某坐标系的三个单位轴来表示旋转矩阵$R$

$$
R=(\hat X\quad\hat Y\quad\hat Z)
$$

这三个矢量均为单位矢量，且两两正交，故有如下6个约束

$$
\begin{split}
&|\hat X|=|\hat Y|=|\hat Z|=1\\
&\hat X\cdot\hat Y=\hat X\cdot\hat Z=\hat Y\cdot\hat Z=0
\end{split}
$$

这意味着我们最少只需给出3个参数就能确定一个物体的姿态。

## X-Y-Z固定角

围绕方向固定不动的参考坐标系主轴旋转的拆解方式称为**固定角**（Fixed Angles）。从X-Y-Z固定角的视角来看，任意姿态的$\{B\}$都可以由以下过程表示：将$\{B\}$与$\{A\}$重合，先绕$\hat{X}_A$旋转$\gamma$角，再绕$\hat{Y}_A$旋转$\beta$角，最后绕$\hat{Z}_A$旋转$\alpha$角得到最终的$\{B\}$。X-Y-Z表示绕主轴旋转的顺序。

![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260125165450.png)

因而可以推导$\{B\}$到$\{A\}$的等价旋转矩阵（式中$c\theta=\cos\theta$，$s\theta=\sin\theta$）

$$
\begin{split}
^A_BR_{XYZ}(\gamma,\beta,\alpha)&=R_Z(\alpha)R_Y(\beta)R_X(\gamma)\\
&=\begin{bmatrix}c\alpha&-s\alpha&0\\s\alpha&c\alpha&0\\0&0&1\end{bmatrix}\begin{bmatrix}c\beta&0&s\beta\\0&1&0\\-s\beta&0&c\beta\end{bmatrix}\begin{bmatrix}1&0&0\\0&c\gamma&-s\gamma\\0&s\gamma&c\gamma\end{bmatrix}\\
&=\begin{bmatrix}c\alpha c\beta&c\alpha s\beta s\gamma-s\alpha c\gamma&c\alpha s\beta c\gamma+s\alpha s\gamma\\s\alpha c\beta&s\alpha s\beta s\gamma+c\alpha c\gamma&s\alpha s\beta c\gamma-c\alpha s\gamma\\-s\beta&c\beta s\gamma&c\beta c\gamma\end{bmatrix}
\end{split}
$$

*矩阵书写顺序与实际旋转操作顺序相反，从旋转一个矢量的角度来看，是因为旋转矩阵乘在矢量的左边，所以右侧的矩阵会先与矢量相乘。*

相应地，我们也可以通过任意旋转矩阵求得X-Y-Z固定角。将旋转矩阵的九个元素与上式联立有

$$
\begin{split}
^A_BR_{XYZ}(\gamma,\beta,\alpha)&=\begin{bmatrix}c\alpha c\beta&c\alpha s\beta s\gamma-s\alpha c\gamma&c\alpha s\beta c\gamma+s\alpha s\gamma\\s\alpha c\beta&s\alpha s\beta s\gamma+c\alpha c\gamma&s\alpha s\beta c\gamma-c\alpha s\gamma\\-s\beta&c\beta s\gamma&c\beta c\gamma\end{bmatrix}\\
&=\begin{bmatrix}r_{11}&r_{12}&r_{13}\\r_{21}&r_{22}&r_{23}\\r_{31}&r_{32}&r_{33}\end{bmatrix}
\end{split}
$$

可解得

$$
\begin{split}
\beta=\mathrm{Atan}2\left(-r_{31},\sqrt{r_{11}^2+r_{21}^2}\right)\\
\alpha=\mathrm{Atan}2\left(\frac {r_{21}}{c\beta},\frac {r_{11}}{c\beta}\right)\\
\gamma=\mathrm{Atan}2\left(\frac {r_{32}}{c\beta},\frac {r_{33}}{c\beta}\right)
\end{split}
$$

式中$\mathrm{Atan2}(y,x)=\tan^{-1}(y/x)$为反正切函数的双参变量表示法，其可根据$x$和$y$的符号判别求得的角所在的象限。

当$\beta=\pm90^\circ$时，$c\beta=0$，此时仅能求出$\alpha$和$\gamma$的和或差。一般取$\alpha=0^\circ$，则

$$
\gamma=\left\{
\begin{split}
\mathrm{Atan2}(r_{12},r_{22}),\quad&\beta=90^\circ\\
-\mathrm{Atan2}(r_{12},r_{22}),\quad&\beta=-90^\circ\\
\end{split}
\right.
$$

## Z-Y-X欧拉角

围绕运动坐标系自身主轴旋转的拆解方式称为**欧拉角**（Euler Angles）。从Z-Y-X欧拉角的视角来看，任意姿态的$\{B\}$都可以由以下过程表示：将$\{B\}$与$\{A\}$重合，先绕$\hat{Z}_B$旋转$\alpha$角，再绕$\hat{Y}_B$旋转$\beta$角，最后绕$\hat{X}_B$旋转$\alpha$角得到最终的$\{B\}$。

![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260125165523.png)

通过中间坐标系$\{B'\}$和$\{B''\}$，我们可以写出由$\{A\}$到$\{B\}$（$\{B'''\}$）的旋转矩阵为

$$
^A_BR={^A_{B'}R}{^{B'}_{B''}R}{^{B''}_{B}R}
$$
则由Z-Y-X欧拉角参数化的旋转矩阵为（下标中的撇号表明这是用欧拉角而非固定角描述的旋转）

$$
\begin{split}
^A_BR_{Z'Y'X'}(\alpha,\beta,\gamma)&={^A_{B'}R}{^{B'}_{B''}R}{^{B''}_{B}R}\\
&=R_Z(\alpha)R_Y(\beta)R_X(\gamma)\\
&=\begin{bmatrix}c\alpha&-s\alpha&0\\s\alpha&c\alpha&0\\0&0&1\end{bmatrix}\begin{bmatrix}c\beta&0&s\beta\\0&1&0\\-s\beta&0&c\beta\end{bmatrix}\begin{bmatrix}1&0&0\\0&c\gamma&-s\gamma\\0&s\gamma&c\gamma\end{bmatrix}\\
&=\begin{bmatrix}c\alpha c\beta&c\alpha s\beta s\gamma-s\alpha c\gamma&c\alpha s\beta c\gamma+s\alpha s\gamma\\s\alpha c\beta&s\alpha s\beta s\gamma+c\alpha c\gamma&s\alpha s\beta c\gamma-c\alpha s\gamma\\-s\beta&c\beta s\gamma&c\beta c\gamma\end{bmatrix}
\end{split}
$$

该结果与X-Y-Z固定角中的一致。由此可见，三次绕固定轴旋转的最终姿态和以相反顺序绕运动坐标轴旋转的最终姿态相同。

固定角和欧拉角均需要按一定顺序进行绕主轴的三个旋转，将XYZ三个主轴进行排列组合（只需要满足相邻两次旋转围绕的主轴不同即可，例如Z-Y-Z），我们可以得到24种旋转矩阵表示法，其中12种为固定角，12种为欧拉角，它们均被称为**转角排列设定法**。

## 等效角度-轴线表示法

在上一篇的变换算子一节中，我们给出过旋转算子$R_K(\theta)$表示绕$\hat K$轴旋转$\theta$角度。如果轴的方向是一般方向而非主轴方向，任何姿态都可通过选择适当的轴和角度来得到，这种表示法即为**等效角度-轴线表示法**。

![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260125173912.png)

令$^A\hat K=(k_x\quad k_y\quad k_z)^T$，则等效旋转矩阵为

$$
R_K(\theta)=\begin{bmatrix}k_x^2v\theta+c\theta&k_xk_yv\theta-k_zc\theta&k_xk_zv\theta+k_ys\theta\\
k_xk_yv\theta+k_zs\theta&k_xk_yv\theta+c\theta&k_yk_zv\theta-k_xs\theta\\
k_xk_zv\theta-k_ys\theta&k_yk_zv\theta+k_xs\theta&k_z^2c\theta\end{bmatrix}
$$

式中$c\theta=\cos\theta$，$s\theta=\sin\theta$，$v\theta=1-\cos\theta$。

其推导思路为，假设有一辅助坐标系$\{U\}$，其$\hat Z$轴与旋转轴$\hat K$一致。

1. 将$\{B\}$与$\{A\}$重合；
2. 通过旋转矩阵$^U_AR$将$\{B\}$相对于$\{A\}$的表示转换为$\{B\}$相对于$\{U\}$的表示；
3. 通过旋转算子$R_Z(\theta)$将$\{B\}$绕$\{U\}$的$\hat Z$轴旋转$\theta$；
4. 再通过旋转矩阵$^A_UR$将$\{B\}$相对于$\{U\}$的表示恢复为$\{B\}$相对于$\{A\}$的表示。

由此等效旋转矩阵可表示为

$$
R_K(\theta)={^A_UR}{R_Z(\theta)}{^U_AR}
$$

已知$^A\hat Z_U=^A\hat K=(k_x\quad k_y\quad k_z)^T$，则

$$
^A_UR=\begin{bmatrix}
A&D&k_x\\B&E&k_y\\C&F&k_z\end{bmatrix}
$$

其中六个未知数根据旋转矩阵的性质满足

$$
\begin{matrix}
A^2+B^2+C^2=1\\
D^2+E^2+F^2=1\\
(A\quad B\quad C)\cdot(D\quad E\quad F)^T=0\\
(A\quad B\quad C)\times(D\quad E\quad F)=(k_x\quad k_y\quad k_z)^T
\end{matrix}
$$

利用上述性质，再由$^U_AR={^A_UR^T}$，可化简等效旋转矩阵为最终结果。

旋转矩阵、固定角、欧拉角和等效角度-轴线表示法均为姿态表示的经典方法，它们在后续更复杂的实际应用中将逐渐面临一些根本性的挑战。现代机器人领域则发展出了四元数表示法以及更高层次的旋量理论，在姿态表示中实现了更加优雅而统一的数学框架，博主将在运动学与动力学的基础篇章结束后对其进行介绍。