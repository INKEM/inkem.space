---
title: 【机器人学|运动学与动力学】#3 操作臂逆运动学基础
published: 2026-02-20
description: 将笛卡尔空间的任务映射到关节空间。
tags: [逆运动学, 工作空间, Pieper解法]
category: 运动学与动力学
---
**逆运动学**（Inverse Kinematics）研究如何根据目标坐标系相对于参考坐标系的期望位姿求解一系列满足期望要求的关节角，是机器人控制的基础。笛卡尔位置和欧拉角/固定角姿态是更符合人类直觉的任务描述框架，但是机器人的运动过程直接由关节空间的变量控制，逆运动学就是将笛卡尔空间的任务映射到关节空间的指令。

用于描述任务的一组变量被称为**任务空间**（Task Space），其应当符合对任务控制需求的直接描述（不一定相互独立），例如移动机器人的质心位置、软体机器人的曲率等。广义逆运动学覆盖任意任务空间到关节空间的映射，本章暂时只研究最基础、最一般化的笛卡尔任务空间。

# 逆运动学问题的解

设末端执行器位姿为$^0_NT$，关节角度为$\mathbf q\in\mathbb R^n$。正向运动学和逆运动学的问题形式分别为

- **正向运动学**：已知$\mathbf q$，求$^0_NT=f(\mathbf q)$；
- **逆运动学**：已知$^0_NT$，求$\mathbf q$满足$f(\mathbf q)={^0_NT}$。

求解逆运动学的难点在于$f$往往是非线性的（包含大量三角函数），且通常不是一对一映射。对于一个非线性方程组，我们需要考虑解是否存在、存在几个解和如何求解三大问题。

## 解的存在性

解是否存在意味着给定末端执行器位姿，是否存在一组操作臂的关节变量使得末端执行器可以到达该位姿。操作臂末端执行器所能到达的位置范围（不考虑姿态）被称为**工作空间**（Workspace）。根据姿态的可达性，工作空间又分为

- **可达工作空间**（Reachable Workspace）：能够以至少一种姿态到达的位置；
- **灵巧工作空间**（Dexterous Workspace）：能够以任何姿态到达的位置。

讨论一个RR操作臂，其中两根连杆分别长$l_1$和$l_2$。假设所有关节能够旋转$360^\circ$，则如果

- $l_1=l_2$
	- 可达工作空间：以原点为中心，半径为$2l_1$的圆；
	- 灵巧工作空间：原点。
- $l_1\neq l_2$
	- 可达工作空间：以原点为中心，外径为$l_1+l_2$，内径为$|l_1-l_2|$的圆环；
	- 灵巧工作空间：无。

![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260220171320.png)

## 多解问题

求解运动学方程往往会遇到多解问题，例如图中的3R操作臂有两种方式到达同一个目标位姿。

![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260220172106.png)

通常，关节数量和连杆的非零参数越多，到达某一特定目标的方式也越多，即解的个数越多。但是系统最终只能选择一个解来执行，因此需要有解的选择标准，其因具体问题而变化。常见的选择标准有：

- **物理可行性**：关节限位，连杆干涉；
- **运动连续性**：最短行程原则，避免关节极限，避免经过奇异位形（参见下一章）；
- **任务需求**：能耗最少，时间最短，障碍规避，拟人动作。


# 逆运动学方程的解法

逆运动学方程作为非线性方程组没有通用的解法，但根据求解方程的两条根本路径，我们可以将解法分为两大类：

- **封闭解**（Closed-form Solution）/**解析解**（Analytical Solution）：通过代数或几何方法，得到一个由基本运算构成的有限表达式，通过该表达式可以得到所有理论解；
- **数值解**（Numerical Solution）：从初始猜测出发，逐步优化使得正向运动学结果逼近目标位姿，得到最接近初值的一个局部近似解。

存在封闭解的机器人必须满足一些特定的几何约束。为了保证实时性和确定性，绝大多数工业机器人在设计之初都以存在封闭解为硬性要求。而如今算力的提升和深度学习的发展也为数值解带来了更多的可行性，让机器人的设计更加灵活、通用。本章我们只讨论简单的封闭解。

封闭解的求解方法分为**代数法**和**几何法**。

## 代数解法

代数解法通过矩阵方程，根据未知数在矩阵中出现的特殊形式，利用纯粹的代数方法进行消元，最终得到关于单个关节变量的方程，可以自然得到全部的解，但计算繁琐，需要一定的数学直觉。

以一个RRR平面操作臂为例，其连杆参数如下：

| $i$ | $\alpha_{i-1}$ | $a_{i-1}$ | $d_i$ | $\theta_i$ |
| --- | -------------- | --------- | ----- | ---------- |
| 1   | 0              | 0         | 0     | $\theta_1$ |
| 2   | 0              | $l_1$     | 0     | $\theta_2$ |
| 3   | 0              | $l_2$     | 0     | $\theta_3$ |
![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260220173002.png)

操作臂末端执行器的位置被约束在由两个独立坐标变量$x$、$y$描述的$xOy$平面内，而姿态绕平面法线的独立旋转，由角度变量$\phi$唯一确定，由此我们可以用三个独立变量描述出它的任务空间为

$$
^0_3T=\begin{bmatrix}c_\phi&-s_\phi&0&x\\s_\phi&c_\phi&0&y\\0&0&1&0\\0&0&0&1\end{bmatrix}
$$

根据正向运动学，我们可以得到其末端位姿矩阵为

$$
^0_3T=\begin{bmatrix}c_{123}&-s_{123}&0&l_1c_1+l_2c_{12}\\s_{123}&c_{123}&0&l_1s_1+l_2s_{12}\\0&0&1&0\\0&0&0&1\end{bmatrix}
$$

其中下标数字组合代表对应关节角的和，如$c_{123}$表示$\cos(\theta_1+\theta_2+\theta_3)$。

将上述两个矩阵联立可得$4$个非线性方程

$$
\begin{split}
①&c_\phi=c_{123}\\
②&s_\phi=s_{123}\\
③&x=l_1c_1+l_2c_{12}\\
④&y=l_1s_1+l_2s_{12}
\end{split}
$$

首先将③和④同时平方后相加得

$$
\begin{split}
x^2+y^2&=l_1^2(c_1^2+s_1^2)+l_2^2(c_{12}^2+s_{12}^2)+2l_1l_2(c_1c_{12}+s_1s_{12})\\
&=l_1^2+l_2^2+2l_1l_2c_2
\end{split}
$$

进而求解$c_2$可得

$$
c_2=\frac{x^2+y^2-l_1^2-l_2^2}{2l_1l_2}
$$

该表达式约束了式子右侧的值必须在$-1\sim1$，否则方程无解。

如果目标点在工作空间内，则$s_2$为

$$
s_2=\pm\sqrt{1-c_2^2}
$$

最后利用双变量反正切函数计算$\theta_2$得

$$
\theta_2=\mathrm{Atan2}(s_2,c_2)
$$

接下来利用③和④求解$\theta_1$，先将其写成如下形式

$$
\begin{split}
x&=l_1c_1+l_2c_{12}\\
&=l_1c_1+l_2c_1c_2-l_2s_1s_2\\
&=(\underset {k_1}{\underbrace{l_1+l_2c_2}})c_1-\underset{k_2}{\underbrace{l_2s_2}}s_1\\
&=k_1c_1-k_2s_1\\
y&=l_1s_1+l_2s_{12}\\
&=l_1s_1+l_2s_1c_2+l_2s_2c_1\\
&=k_1s_1+k_2c_1
\end{split}
$$

再对$k_1$和$k_2$进行极坐标变量代换，即令

$$
\begin{split}
r&=\sqrt{k_1^2+k_2^2}\\
\gamma&=\mathrm{Atan2}(k_2,k_1)
\end{split}
$$

则有

$$
\begin{split}
k_1&=r\cos\gamma\\
k_2&=r\sin\gamma
\end{split}
$$

③和④可进一步写成

$$
\begin{split}
\frac xr&=\cos\gamma\cos\theta_1-\sin\gamma\sin\theta_1=\cos(\gamma+\theta_1)\\
\frac yr&=\cos\gamma\sin\theta_1+\sin\gamma\cos\theta_1=\sin(\gamma+\theta_1)
\end{split}
$$

利用双变量反正切函数得

$$
\gamma+\theta_1=\mathrm{Atan2}(\frac yr,\frac xr)=\mathrm{Atan2}(y,x)
$$

从而

$$
\theta_1=\mathrm{Atan2}(y,x)-\mathrm{Atan2}(k_2,k_1)
$$

如果$x=y=0$，则上式无定义，$\theta_1$可取任意值。

$\theta_3$则利用①和②求出

$$
\begin{split}
\theta_1+\theta_2+\theta_3&=\mathrm{Atan2}(s_\phi,c_\phi)=\phi\\
\theta_3&=\phi-\theta_1-\theta_2
\end{split}
$$

## 几何解法

几何解法将操作臂的空间几何参数分解为平面几何问题，从几何图形中推导出关节角度，直观高效，但推导过程依赖于特定几何构型，需要一定的空间想象力。

以同一个3R操作臂为例，将其置于如下平面直角坐标系中：

![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260220174234.png)

对于实线三角形，利用余弦定理可求解$\theta_2$

$$
\begin{split}
x^2+y^2&=l_1^2+l_2^2-2l_1l_2\cos(\theta_2+180^\circ)\\
c_2&=\frac{x^2+y^2-l_1^2-l_2^2}{2l_1l_2}
\end{split}
$$

从几何的角度看，上式成立的条件是余弦定理所依赖的三角形存在，即到目标点的距离$\sqrt{x^2+y^2}$必须小于等于两个连杆长度之和$l_1+l_2$。虚线三角形对应的另一个可能的解由对称关系$\theta_2'=\theta_2$得到。

$\theta_1$由$\psi$和$\beta$间接求出。其中$\beta$根据双变量反正切函数得到

$$
\beta=\mathrm{Atan2}(y,x)
$$

再对虚线三角形应用余弦定理

$$
\cos\psi=\frac{x^2+y^2+l_1^2-l_2^2}{2l_1\sqrt{x^2+y^2}}
$$

通过反余弦解得$\psi$并满足$0\leq\psi\leq180^\circ$使三角形存在。现在可得$\theta_1$为

$$
\theta_1=\beta\pm\psi
$$

当$\theta_2<0$时取“$+$”号，当$\theta_2>0$时取“$-$”号。

最终根据目标姿态$\phi$求出$\theta_3$为

$$
\theta_3=\phi-\theta_1-\theta_2
$$

## 三轴相交的Pieper解法

一般的六自由度机器人没有封闭解，除非满足一些特殊情况。一个最经典的判断六自由度机器人是否存在封闭解的依据是**Pieper准则**，对于6R操作臂而言，只要其满足如下两个充分条件中的一个就存在封闭解：

- 三个相邻关节轴相交于一点；
- 三个相邻关节轴相互平行。

大多数传统工业机器人均根据Pieper准则设计最后三个关节轴线交于一点，称为**腕点**（Wrist Point）。此时关节1、2、3负责定位，起到手臂的作用；关节4、5、6负责定向，起到手腕的作用。本章我们只简要讨论该情况下Pieper解法的大致过程。

![](https://inkem-1306784622.cos.accelerate.myqcloud.com/blog/pic/Pasted%20image%2020260220175007.png)

现在前三个关节的任务被简化为将腕点移动到空间中的指定点

$$
^0P_{4ORG}={^0_1T}{^1_2T}{^2_3T}{^3P_{4ORG}}=[x,y,z,1]^T
$$

根据DH参数法的连杆变换矩阵，展开$^3P_{4ORG}$

$$
^0P_{4ORG}={^0_1T}{^1_2T}{^2_3T}\begin{bmatrix}a_3\\-d_4s\alpha_3\\d_4c\alpha_3\\1\end{bmatrix}
$$

继续展开$^2_3T$并左乘

$$
^0P_{4ORG}={^0_1T}{^1_2T}\begin{bmatrix}f_1\\f_2\\f_3\\1\end{bmatrix}
$$

其中

$$
\begin{split}
f_1&=a_3c_3+d_4s\alpha_3s_3+a_2\\
f_2&=a_3c\alpha_2s_3-d_4s\alpha_3c\alpha_2c_3-d_4s\alpha_2c\alpha_3-d_3s\alpha_2\\
f_3&=a_3s\alpha_2s_3-d_4s\alpha_3s\alpha_2c_3+d_4c\alpha_2c\alpha_3+d_3c\alpha_2
\end{split}
$$

继续展开$^0_1T$和$^1_2T$得到

$$
^0P_{4ORG}=\begin{bmatrix}c_1g_1-s_1g_2\\s_1g_1+c_1g_2\\g_3\\1\end{bmatrix}
$$

其中

$$
\begin{split}
g_1&=c_2f_1-s_2f_2+a_1\\
g_2&=s_2c\alpha_1f_1+c_2c\alpha_1f_2-s\alpha_1f_3-d_2s\alpha_1\\
g_3&=s_2s\alpha_1f_1+c_2s\alpha_1f_2+c\alpha_1f_3+d_2c\alpha_1\\
\end{split}
$$

通过$^0P_{4ORG}$的模的平方可联立得到如下方程（消去$\theta_1$）

$$
\begin{split}
r=&x^2+y^2+z^2\\
=&(c_1g_1-s_1g_2)^2+(s_1g_1+c_1g_2)^2+g_3^2\\
=&g_1^2+g_2^2+g_3^2\\
=&f_1^2+f_2^2+f_3^2+a_1^2+d_2^2+2d_2f_3+2a_1(c_2f_1-s_2f_2)
\end{split}
$$

针对$z$分量可列出另一个方程

$$
z=g_3=s_2s\alpha_1f_1+c_2s\alpha_1f_2+c\alpha_1f_3+d_2c\alpha_1
$$

如果令

$$
\begin{split}
k_1&=f_1\\
k_2&=-f_2\\
k_3&=f_1^2+f_2^2+f_3^2+a_1^2+d_2^2+2d_2f_3\\
k_4&=f_3c\alpha_1+d_2c\alpha_1
\end{split}
$$

则可将$r$和$z$的方程联立写为关于$\theta_2$和$\theta_3$（在$k_i$中）的方程组

$$
\begin{split}
r&=(k_1c_2+k_2s_2)2a_1+k_3\\
z&=(k_1s_2-k_2c_2)s\alpha_1+k_4
\end{split}
$$

$\theta_3$可分三种情况求解：

- 若$a_1=0$，则$r=k_3$。$r$已知，$k_3$是关于$\theta_3$的一元函数；
- 若$s\alpha_1=0$，则$z=k_4$。$z$已知，$k_4$是关于$\theta_3$的一元函数；
- 否则，消元法消去$c_2$和$s_2$，得到

$$
\frac{(r-k_3)^2}{4a_1^2}+\frac{(z-k_4)^2}{s^2\alpha_1}=k_1^2+k_2^2
$$

上述未知数涉及$\cos$和$\sin$的一元超越方程均可利用三角函数的万能公式由中间变量$u$转化为多项式方程

$$
\begin{split}
u&=\tan\frac\theta2\\
\cos\theta&=\frac{1-u^2}{1+u^2}\\
\sin\theta&=\frac{2u}{1+u^2}
\end{split}
$$

只要超越方程能转化为四次及以下的多项式方程，即存在通用形式的封闭解。由此可根据方程组依次解出$\theta_3$和$\theta_2$，再由下式解出$\theta_1$

$$
^0P_{4ORG}=\begin{bmatrix}c_1g_1-s_1g_2\\s_1g_1+c_1g_2\\g_3\\1\end{bmatrix}=[x,y,z,1]^T
$$

为了完成求解工作，还需要求出$\theta_4$、$\theta_5$、$\theta_6$，由于这些轴相交，原点已经确定，故这些关节角只影响末端连杆的姿态。先利用已经解出的$\theta_1$、$\theta_2$、$\theta_3$算出连杆坐标系$\{4\}$的初始姿态$^4_0R|_{\theta_4=0}$，再计算出以此为参考坐标系的末端连杆的姿态描述

$$
{^4_6R|_{\theta_4=0}}={^0_4R^{-1}|_{\theta_4=0}}{}_6^0R
$$

最终用欧拉角的形式定义最后三个关节角得到旋转矩阵后与$^4_6R|_{\theta_4=0}$联立即可完成求解。